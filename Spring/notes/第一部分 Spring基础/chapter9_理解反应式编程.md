# chapter9 理解反应式编程

- 命令式代码（Imperative）
    - 由一组任务组成，每次只运行一项任务，每项任务又都依赖于前面的任务。数据会按批次进行处理，在前一项任务还没有完成对当前数据批次的处理时，不能将这些数据递交给下一项处理任务
- 反应式代码（Reactive）
    - 定义一组用来处理数据的任务，但是这些任务可以**并行执行**。每项任务处理数据的一部分子集，并将结果交给处理流程中的下一项任务，同时继续处理数据的另一部分子集

## 一、反应式编程概览

反应式流（Reactive Streams），旨在提供无阻塞回压的异步流处理标准

- 通过回压，数据消费者可以限制它们想要处理的数据数量，避免被过快的数据源所淹没

### Java的流和反应式流

- Java的流通常是同步的，并且只能处理有限的数据集。本质上，它们只是函数来对集合进行迭代的一种方式

- 反应式流支持异步处理任意大小的数据集，同样也包括无限数据集。只要数据就绪，它们就能实时地处理数据，并且能够通过回压来避免压垮数据的消费者
    - 反应式流规范可以总结为 4 个接口：
        - Publisher：负责生成数据，并将数据发送给Subscription；声明了一个方法subscribe()，Subscriber可以通过该方法向Publisher发起订阅
        - Subscriber
        - Subscription
        - Processor

## 二、初识Reactor

反应式编程意味着要构建数据将要流经的管道

Reactor的两个核心类型：Mono、Flux，两者都实现了反应式流的Publisher接口

- Flux代表具有零、一个或多个（可能是无限个）数据项的管道

- Mono是一种特殊的反应式类型，针对数据项不超过一个的场景，它进行了优化

### 绘制反应式流图

反应式流程通常使用弹珠图（marble diagram）表示

![image-20220512004610856](https://cdn.jsdelivr.net/gh/Lance-Mai/MyPictureBed/images/image-2022/image-20220512004610856.png)

---

![image-20220512004639393](https://cdn.jsdelivr.net/gh/Lance-Mai/MyPictureBed/images/image-2022/image-20220512004639393.png)

### 常见的反应式操作

Flux和Mono是Reactor提供的最基础的构建块，而这两种反应式类型所提供的操作符则是组合使用它们以构建流动管线的粘合剂。Flux和Mono共有500多个操作，这些操作大致归类为：

1. 创建操作
2. 组合操作
3. 转换操作
4. 逻辑操作

